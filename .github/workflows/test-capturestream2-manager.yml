name: macOS CaptureStream2 Manager Full Test

on:
  push:
    paths:
      - 'capturestream2-manager.sh'
  workflow_dispatch:

jobs:
  test-full-manager:
    runs-on: macos-latest

    steps:
      - name: リポジトリをチェックアウト
        uses: actions/checkout@v3

      - name: Homebrew Tap を追加
        run: |
          brew tap CSReviser/capturestream2

      - name: スクリプトに実行権限を付与
        run: chmod +x ./capturestream2-manager.sh

      - name: 最新版のインストールテスト
        run: brew install --cask capturestream2

      - name: 最新版のアップグレード（再インストール）テスト
        run: brew reinstall --cask capturestream2

      - name: 最新版のアップデートテスト
        run: brew upgrade --cask capturestream2

      - name: インストール済みキャスクの一覧確認
        run: brew list --cask

      - name: 利用可能なバージョンの一覧確認
        run: brew search capturestream2

      - name: ロールバックバージョンのインストールテスト
        run: |
          brew install --cask capturestream2@20250324

      - name: ロールバックバージョンのアンインストールテスト
        run: |
          brew uninstall --cask capturestream2@20250324

      - name: 最新版の再インストール（ロールバック解除）
        run: brew reinstall --cask capturestream2

      - name: 最新版のアンインストールテスト
        run: brew uninstall --cask capturestream2