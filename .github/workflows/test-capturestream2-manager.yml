name: Test CaptureStream2 Manager

on:
  push:
    paths:
      - 'capturestream2-manager.sh'
      - '.github/workflows/test-capturestream2-manager.yml'
  workflow_dispatch:

jobs:
  test:
    runs-on: macos-latest
    steps:
      - name: チェックアウト
        uses: actions/checkout@v3

      - name: Homebrew tap 追加
        run: |
          brew tap CSReviser/capturestream2

      - name: スクリプトに実行権限付与
        run: chmod +x ./capturestream2-manager.sh

      - name: 最新版インストール
        run: ./capturestream2-manager.sh install

      - name: インストール済み一覧表示
        run: ./capturestream2-manager.sh list

      - name: ロールバック（1番目を選択）
        run: ./capturestream2-manager.sh rollback 1

      - name: ロールバック解除
        run: ./capturestream2-manager.sh rollback-reset 1

      - name: 一覧表示テスト
        run: ./capturestream2-manager.sh <<< "5"

      - name: バージョン一覧取得（ログ用）
        run: brew search capturestream2
